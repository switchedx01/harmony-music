# dad_player/kv/main_screen.kv

<HoverTitleBarButton@MDIconButton>:
    # A reusable style for all title bar buttons except close.
    hovering: False
    md_bg_color: self.theme_cls.primary_color if self.hovering else [0, 0, 0, 0]
    icon_color: [1, 1, 1, 1]
    ripple_scale: 0

<HoverCloseButton@HoverTitleBarButton>:
    # A specific style for the close button for a different hover color.
    md_bg_color: [0.8, 0.2, 0.2, 1] if self.hovering else [0, 0, 0, 0]


<MainScreen>:
    MDBoxLayout:
        orientation: 'vertical'

        MDBoxLayout:
            id: title_bar
            size_hint_y: None
            height: "40dp"
            padding: "8dp"
            spacing: "8dp"
            canvas.before:
                Color:
                    rgba: app.theme_cls.bg_darkest
                Rectangle:
                    pos: self.pos
                    size: self.size

            MDLabel:
                text: root.top_bar_title
                halign: "left"
                valign: "center"
                size_hint_x: 1

            # --- WINDOW CONTROL BUTTONS ---
            HoverTitleBarButton:
                id: dashboard_button
                icon: "view-dashboard-outline"
                pos_hint: {"center_y": 0.5}
                on_release: root.open_dashboard()
                tooltip_text: "Dashboard"

            HoverTitleBarButton:
                id: minimize_button
                icon: "window-minimize"
                pos_hint: {"center_y": 0.5}
                on_release: root.minimize_window()
                tooltip_text: "Minimize"

            HoverTitleBarButton:
                id: maximize_button
                icon: "window-maximize"
                pos_hint: {"center_y": 0.5}
                on_release: root.toggle_maximize_window()
                tooltip_text: "Maximize"

            HoverCloseButton:
                id: close_button
                icon: "close"
                pos_hint: {"center_y": 0.5}
                on_release: root.close_window()
                tooltip_text: "Close"

        MDScreenManager:
            id: layout_manager

            # --- DESKTOP LAYOUT SCREEN ---
            MDScreen:
                name: 'desktop_layout'

                MDBoxLayout:
                    orientation: 'horizontal'

                    MDNavigationRail:
                        id: nav_rail
                        md_bg_color: app.theme_cls.bg_dark
                        MDNavigationRailItem:
                            name: "now_playing_screen"
                            text: "Playing"
                            icon: "play-circle-outline"
                            on_release: root.switch_view("now_playing_screen")
                        MDNavigationRailItem:
                            name: "library_screen"
                            text: "Library"
                            icon: "music-box-multiple"
                            on_release: root.switch_view("library_screen")
                        MDNavigationRailItem:
                            name: "playlist_screen"
                            text: "Playlist"
                            icon: "playlist-music-outline"
                            on_release: root.switch_view("playlist_screen")

                    MDScreenManager:
                        id: desktop_screen_manager
                        canvas.before:
                            Color:
                                rgba: app.theme_cls.bg_darkest
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        MDScreen:
                            name: 'now_playing_screen'
                        MDScreen:
                            name: 'library_screen'
                        MDScreen:
                            name: 'playlist_screen'

            # --- MOBILE LAYOUT SCREEN ---
            MDScreen:
                name: 'mobile_layout'

                MDBoxLayout:
                    orientation: 'vertical'

                    MDBottomNavigation:
                        id: bottom_nav
                        selected_color_background: app.theme_cls.primary_color
                        panel_color: app.theme_cls.bg_dark
                        on_switch_tabs: root.on_switch_tabs(*args)

                        MDBottomNavigationItem:
                            name: 'now_playing_screen'
                            text: 'Playing'
                            icon: 'play'
                            id: mobile_now_playing_screen

                        MDBottomNavigationItem:
                            name: 'library_screen'
                            text: 'Library'
                            icon: 'music-box-multiple'
                            id: mobile_library_screen

                        MDBottomNavigationItem:
                            name: 'playlist_screen'
                            text: 'Playlist'
                            icon: 'playlist-music-outline'
                            id: mobile_playlist_screen

    MDNavigationDrawer:
        id: nav_drawer
        MDNavigationDrawerMenu:
            MDNavigationDrawerHeader:
                title: "Harmony Player"
                spacing: "4dp"
                padding: "12dp", 0, 0, "32dp"

            MDNavigationDrawerItem:
                icon: "cog"
                text: "Settings"
                on_release:
                    nav_drawer.set_state("close")
                    app.switch_screen('settings_screen')

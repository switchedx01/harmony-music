# dad_player/kv/screens/library_view.kv

#:import AlbumGridItem dad_player.ui.widgets.album_grid_item.AlbumGridItem
#:import SongListItem dad_player.ui.widgets.song_list_item.SongListItem
#:import SongRowItem dad_player.ui.widgets.song_list_item.SongRowItem
#:import ArtistListItem dad_player.ui.widgets.artist_list_item.ArtistListItem
#:import dp kivy.metrics.dp

<LibraryView>:
    orientation: 'vertical'

    MDBoxLayout:
        adaptive_height: True
        padding: "16dp", "8dp"
        spacing: "12dp"

        MDIconButton:
            icon: "arrow-left"
            on_release: root.go_back_library_navigation()
            disabled: root.current_view_mode == 'all_albums'

        MDLabel:
            text: root.display_path_text
            font_style: "H6"
            adaptive_height: True
            shorten: True

        MDRaisedButton:
            text: "Artists"
            on_release: root.show_all_artists()

        MDRaisedButton:
            text: "Scan"
            on_release: root.start_full_scan()

    MDBoxLayout:
        adaptive_height: True
        padding: "16dp", 0, "16dp", "8dp"

        MDTextField:
            id: search_field
            hint_text: "Search Songs, Albums, Artists"
            mode: "round"
            icon_right: "magnify"
            on_text: root.on_search_text(self.text)

    MDBoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: dp(48) if root.is_scanning else 0
        opacity: 1 if root.is_scanning else 0
        padding: "16dp", "8dp"

        MDProgressBar:
            value: root.progress_value * 100

        MDLabel:
            text: root.scan_progress_message
            halign: 'center'
            theme_text_color: "Secondary"
            adaptive_height: True
    
    MDLabel:
        id: no_results_label
        text: "No results found"
        halign: "center"
        font_style: "H6"
        theme_text_color: "Secondary"
        size_hint_y: None
        height: 0
        opacity: 0

    MDBoxLayout:
        id: album_art_container
        orientation: 'vertical'
        size_hint_y: None
        height: (dp(316) if not root.is_wide else dp(360)) if root.current_view_mode == 'songs_for_album' else 0
        opacity: 1 if root.current_view_mode == 'songs_for_album' else 0
        padding: dp(16)

        Image:
            source: root.album_art_path
            size_hint: None, None
            size: (dp(256), dp(256)) if not root.is_wide else (dp(300), dp(300))
            pos_hint: {'center_x': 0.5}

        MDBoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(60)
            MDLabel:
                text: root.display_path_text
                halign: 'center'
                font_style: "H6"
            MDLabel:
                text: root.album_artist
                halign: 'center'
                theme_text_color: "Secondary"

    RecycleView:
        id: library_rv
        viewclass: 'AlbumGridItem'

        RecycleGridLayout:
            id: rv_layout
            cols: 2
            spacing: dp(16)
            padding: dp(16)
            default_size: (None, dp(240))
            default_size_hint: (1, None)
            size_hint_y: None
            height: self.minimum_height